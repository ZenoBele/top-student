<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Top Student - Terms & Conditions</title>
	<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon.png">
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
  </head>
<body class="bg-gray-900 text-white min-h-screen">

<header class="bg-gray-700 shadow mb-6">
    <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center gap-3">
        <span class="text-lg font-bold text-white">Top Student</span>
      </div>
      <nav class="flex gap-6 text-base text-white">
        <a href="https://www.google.com/search?q=south+african+bursaries" target="_blank" class="group transition-transform duration-200">
          <span class="group-hover:hidden font-semibold">Ex</span>
          <span class="hidden group-hover:inline-block font-medium text-blue-700 transition-all duration-500 ease-in">Explore bursaries</span>
        </a>
        <a href="https://nsfas.org.za" target="_blank" class="group transition-transform duration-200">
          <span class="group-hover:hidden font-semibold">App</span>
          <span class="hidden group-hover:inline-block font-medium text-blue-700 transition-all duration-500 ease-in">Application at NSFAS</span>
        </a>
        <a href="https://www.google.com/search?q=bursaries" target="_blank" class="group transition-transform duration-200">
          <span class="group-hover:hidden font-semibold">Bu</span>
          <span class="hidden group-hover:inline-block font-medium text-blue-700 transition-all duration-500 ease-in">bursaries & Info</span>
        </a>
      </nav>
    </div>
  </header>

  <div id="terms" class="max-w-3xl mx-auto p-6">
    <h1 class="text-4xl font-bold text-indigo-400 mb-6">Terms & Conditions</h1>

    <p class="mb-6">
      Welcome to Top Student. Please read these Terms & Conditions carefully before using our services.
      By clicking <strong>"I Accept"</strong>, you agree to the following terms which are designed to protect Top Student (operated by Vhulenda Bele) above all else.
    </p>

    <section class="mb-6 space-y-4 text-sm leading-relaxed">
      <p><strong>1. Accuracy and Honesty</strong><br />
      You confirm that all information and documents you provide are truthful, accurate, and belong to the applicant. Any falsification, misrepresentation, or fraudulent information may result in immediate termination of services and banning from Top Student.</p>

      <p><strong>2. No Guarantee of Approval</strong><br />
      Top Student provides guidance and assistance only. We do NOT guarantee NSFAS or any other funding approvals. All decisions rest solely with the funding authorities.</p>

      <p><strong>3. Data Privacy and Usage</strong><br />
      We will securely store your personal information and documents only to assist with your application. We do not share your data with third parties without your explicit consent. You agree that Top Student may contact you via phone, SMS, WhatsApp, or email for updates or clarifications.</p>

      <p><strong>4. Limitation of Liability</strong><br />
      Under no circumstances will Top Student, its owners, employees, or affiliates be held liable for any direct, indirect, incidental, consequential, or punitive damages arising out of your use of the services or reliance on information provided.</p>

      <p><strong>5. User Conduct</strong><br />
      You agree not to misuse or abuse the services, harass staff, or submit malicious or false documents. Violation of this will result in permanent removal from all services without refund.</p>

      <p><strong>6. Intellectual Property</strong><br />
      All content, branding, and materials are property of Top Student. You may not reproduce or use any materials without written permission.</p>

      <p><strong>7. Changes to Terms</strong><br />
      Top Student reserves the right to update or change these Terms & Conditions at any time. Your continued use after changes means you accept the new terms.</p>

      <p><strong>8. Governing Law</strong><br />
      These Terms are governed by the laws of South Africa. Any disputes will be resolved under South African jurisdiction.</p>
    </section>

<form id="acceptForm">
  <div class="mt-6 mb-6">
    <label class="flex items-start gap-2">
      <input type="checkbox" id="agree" class="mt-1 py-3 px-3">
      <span class="text-sm leading-relaxed text-gray-700">
        I have read, understood, and agree to the Terms & Conditions of Top Student and the relevant universities.
      </span>
    </label>
  </div>

  <button
    type="submit"
    id="continueBtn"
    class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg transition shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
    disabled
  >
    Continue to Application
  </button>
</form>

</div>
<div id="applicationReceivedMsg" class="hidden mt-4 p-4 bg-green-900 text-green-300 rounded-lg text-center font-semibold">
  Your application is received. Check your WhatsApp, junk email, or contact <strong>072 730 6186</strong>.
  <a href="premium.html"><button
    type="submit"
    class="w-full mt-4 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition shadow-lg"
  >
    Ok
  </button></a>
</div>

<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

  const supabase = createClient(
    'https://mlwxxtvsozhwzjxmsvbg.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1sd3h4dHZzb3pod3pqeG1zdmJnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg4OTAwOTksImV4cCI6MjA2NDQ2NjA5OX0.i9KySUVeot9imnALKr79DYySocuj0_rko4nzPhPxekU'
  );

async function checkUserApplication() {
    const {
      data: { user },
      error: userError,
    } = await supabase.auth.getUser();

    if (userError || !user) {
      // Not logged in, redirect or handle
      window.location.href = "/login.html";
      return;
    }

    const { data, error } = await supabase
      .from('nsfas_applications')
      .select('id_number')
      .eq('user_id', user.id)
      .single();

    const terms = document.getElementById('terms');
    const receivedMsg = document.getElementById('applicationReceivedMsg');

    if (error) {
      console.error('Error fetching application:', error);
      terms.disabled = false;
      return;
    }

    if (data && data.id_number) {
      // Application exists, hide button & show message
      terms.style.display = 'none';
      receivedMsg.classList.remove('hidden');
    } else {
      // No application yet, enable button & hide message just in case
      terms.disabled = false;
      receivedMsg.classList.add('hidden');
    }
  }

  checkUserApplication();

  const { data: { user }, error } = await supabase.auth.getUser();

  if (!user) {
    window.location.href = "../login.html";
  } else {
    const { data, error: roleError } = await supabase
      .from('profiles')
      .select('role')
      .eq('id', user.id)
      .single();

    if (roleError || !data || data.role !== 'premium') {
      window.location.href = "../index.html";
    }
  }

  const agreeCheckbox = document.getElementById('agree');
  const continueBtn = document.getElementById('continueBtn');

  agreeCheckbox.addEventListener('change', () => {
    continueBtn.disabled = !agreeCheckbox.checked;
    continueBtn.classList.toggle('opacity-30', !agreeCheckbox.checked);
    continueBtn.classList.toggle('cursor-not-allowed', !agreeCheckbox.checked);
  });

const form = document.getElementById('acceptForm');
form.addEventListener('submit', async (e) => {
  e.preventDefault();

  const accepted = document.getElementById('agree').checked;
  if (!accepted) {
    await Swal.fire({
      icon: 'warning',
      title: 'Terms & Conditions',
      text: 'Please accept the Terms & Conditions to continue.',
      confirmButtonText: 'OK'
    });
    return;
  }

  if (!user) {
    await Swal.fire({
      icon: 'error',
      title: 'Not Logged In',
      text: 'You must be logged in to continue.',
      confirmButtonText: 'OK'
    });
    return;
  }

  const { error } = await supabase
    .from('nsfas_applications')
    .upsert(
      [{ user_id: user.id, terms_accepted: true }],
      { onConflict: ['user_id'] }
    );

  if (error) {
    await Swal.fire({
      icon: 'error',
      title: 'Error',
      text: 'Error saving acceptance: ' + error.message,
      confirmButtonText: 'OK'
    });
    return;
  }

  window.location.href = 'nsfas.html';
});
</script>
</body>
</html>