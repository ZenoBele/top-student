<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Request a Call with Zeno</title>
	<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon.png">
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
  </head>
  <body class="bg-gray-900 text-gray-100">
    <!-- Header -->
    <header class="bg-gray-800 shadow-md py-4 px-6 flex justify-between items-center">
      <div class="text-xl font-bold text-white tracking-wider">
        Top Student
      </div>
      <nav class="space-x-4 text-sm">
        <a href="premium.html" class="text-gray-300 hover:text-white transition">Home</a>
        <a href="about_life.html" class="text-gray-300 hover:text-white transition">About</a>
        <a href="contact.html" class="text-gray-300 hover:text-white transition">Contact</a>
      </nav>
    </header>

<section class="min-h-screen flex flex-col items-center justify-center">
  <h1 class="text-5xl font-bold text-center text-white tracking-tight">LIFE</h1>

  <p class="text-center text-md text-gray-300 max-w-3xl">
    Life after school isnâ€™t about you anymore â€” But real growth demands something deeper.
    <br/><br/>
</section>

    <section class="min-h-screen flex items-center justify-center">
      <div class="bg-gray-800 shadow-2xl rounded-2xl max-w-3xl w-full p-8">
        <h2 class="text-3xl font-bold text-center mb-6 text-white">ðŸ“ž Request a Call with Zeno</h1>

        <p class="text-center text-sm text-gray-400 mb-4">
          One call. Full clarity. Discipline. Direction. Let's talk.
        </p>
<form id="callRequestForm" class="space-y-6">
          <div>
            <label class="block font-semibold text-sm mb-1" for="fullName">Full Name</label>
            <input
              type="text"
              id="name"
              name="name"
              required
              class="w-full border border-gray-600 bg-gray-700 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring focus:ring-indigo-400"
            />
          </div>

          <div>
            <label class="block font-semibold text-sm mb-1" for="email">Email Address</label>
            <input
              type="email"
              id="email"
              name="email"
              required
              class="w-full border border-gray-600 bg-gray-700 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring focus:ring-indigo-400"
            />
          </div>

          <div>
            <label class="block font-semibold text-sm mb-1" for="contact">WhatsApp Number</label>
            <input
              type="tel"
              id="contact"
              name="contact"
              placeholder="e.g. 071 234 5678"
              required
              class="w-full border border-gray-600 bg-gray-700 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring focus:ring-green-400"
            />
          </div>

          <div>
            <label class="block font-semibold text-sm mb-1" for="message">What are you struggling with?</label>
            <textarea
              id="message"
              name="message"
              rows="4"
              class="w-full border border-gray-600 bg-gray-700 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring focus:ring-red-400"
              placeholder="Tell Zeno whatâ€™s holding you back..."
              required
            ></textarea>
          </div>

  <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl shadow-lg transition">
    <span id="submitText">Book</span>
    <span id="loader" class="hidden animate-spin ml-2 border-2 border-t-2 border-white rounded-full w-4 h-4 inline-block align-middle"></span>
  </button>
</form>
        <div class="mt-10 border-t border-gray-700 pt-6">
          <h2 class="text-xl font-semibold mb-2 text-white">What Happens During the Call?</h2>
          <ul class="list-disc list-inside text-sm text-gray-300 space-y-1">
            <li>ðŸ“˜ Zeno listens, connects, and builds real rapport with you.</li>
            <li>ðŸ§  Diagnoses your mindset and habits â€” zero judgment.</li>
            <li>ðŸ”¥ Shares his own transformation and battle-tested lessons.</li>
            <li>ðŸ’ª Teaches the power of self-control and daily discipline.</li>
            <li>ðŸ’¬ Helps you open up emotionally and set clear intentions.</li>
            <li>ðŸ§­ Gives personalized rituals and a game plan.</li>
            <li>ðŸ“… Optionally, schedules a follow-up to track progress.</li>
          </ul>
        </div>

        <div class="mt-8 text-center text-xs text-gray-500">
          Calls are audio-only. Your info is private. Zeno will contact you personally.
        </div>
      </div>
    </section>
	
<script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabase = createClient(
      'https://mlwxxtvsozhwzjxmsvbg.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1sd3h4dHZzb3pod3pqeG1zdmJnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg4OTAwOTksImV4cCI6MjA2NDQ2NjA5OX0.i9KySUVeot9imnALKr79DYySocuj0_rko4nzPhPxekU'
    );
	
const { data: { user }, error } = await supabase.auth.getUser();

  if (!user) {
    // Not logged in
    window.location.href = "/login.html";
  } else {
    const { data, error: roleError } = await supabase
      .from('profiles')
      .select('role')
      .eq('id', user.id)
      .single();

    if (roleError || !data || data.role !== 'premium') {
      window.location.href = "/premium-required.html"; // or home page
    }
  }	
	
const form = document.getElementById('callRequestForm');
  const loader = document.getElementById('loader');
  const submitText = document.getElementById('submitText');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    loader.classList.remove('hidden');
    submitText.textContent = "Booking...";

    const { data: { user } } = await supabase.auth.getUser();

    if (!user) {
      Swal.fire("Error", "You must be logged in to submit.", "error");
      loader.classList.add('hidden');
      submitText.textContent = "Book";
      return;
    }

    const { data: profile } = await supabase
      .from('profiles')
      .select('role')
      .eq('id', user.id)
      .single();

    if (!profile || profile.role !== 'premium') {
      Swal.fire("Access Denied", "Only premium users can submit.", "error");
      loader.classList.add('hidden');
      submitText.textContent = "Book";
      return;
    }

    const formData = new FormData(form);
    const payload = {
  name: formData.get('name'),
  email: formData.get('email'),
  contact: formData.get('contact'),
  message: formData.get('message'),
  user_id: user.id
};

    const { error } = await supabase.from('life_calls').insert([payload]);

    loader.classList.add('hidden');
    submitText.textContent = "Book";

    if (error) {
      Swal.fire("Error", error.message, "error");
    } else {
      Swal.fire("Success", "Call request submitted!", "success");
      setTimeout(() => {
        window.location.href = "premium.html";
      }, 1500);
    }
  });
</script>
  </body>
</html>
